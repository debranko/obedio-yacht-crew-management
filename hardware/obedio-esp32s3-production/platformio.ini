; ═══════════════════════════════════════════════════════════════════════════
; PlatformIO Project Configuration File
; ═══════════════════════════════════════════════════════════════════════════
;
; OBEDIO ESP32-S3 Smart Button - Production Firmware
;
; Build environments for ESP32-S3R8 custom PCB
;
; Please visit documentation for the other options and examples
; https://docs.platformio.org/page/projectconf.html

[platformio]
default_envs = esp32s3-production

; ═══════════════════════════════════════════════════════════════════════════
; Common Settings (shared across all environments)
; ═══════════════════════════════════════════════════════════════════════════

[env]
platform = espressif32
framework = arduino
monitor_speed = 115200
monitor_filters =
    esp32_exception_decoder
    colorize
    time

; Library dependencies
lib_deps =
    knolleary/PubSubClient@^2.8
    adafruit/Adafruit MCP23017 Arduino Library@^2.3.0
    adafruit/Adafruit NeoPixel@^1.12.0
    bblanchon/ArduinoJson@^6.21.0
    adafruit/Adafruit BusIO@^1.14.1

; Build flags
build_flags =
    -DCORE_DEBUG_LEVEL=3
    -DBOARD_HAS_PSRAM
    -DARDUINO_USB_CDC_ON_BOOT=1
    -DARDUINO_USB_MODE=1
    -DCONFIG_ESP32S3_DEFAULT_CPU_FREQ_240=1

; ═══════════════════════════════════════════════════════════════════════════
; Production Environment (ESP32-S3 DevKitC-1)
; ═══════════════════════════════════════════════════════════════════════════

[env:esp32s3-production]
board = esp32-s3-devkitc-1
board_build.arduino.memory_type = qio_opi
board_build.partitions = default_8MB.csv
board_build.f_cpu = 240000000L
board_build.f_flash = 80000000L
board_build.flash_mode = qio
upload_speed = 921600
monitor_rts = 0
monitor_dtr = 0

; ═══════════════════════════════════════════════════════════════════════════
; Development Environment (with extra debugging)
; ═══════════════════════════════════════════════════════════════════════════

[env:esp32s3-debug]
board = esp32-s3-devkitc-1
board_build.arduino.memory_type = qio_opi
board_build.partitions = default_8MB.csv
upload_speed = 921600
build_type = debug
build_flags =
    ${env.build_flags}
    -DCORE_DEBUG_LEVEL=5
    -DDEBUG_ESP_PORT=Serial
    -DDEBUG_ESP_WIFI
    -DDEBUG_ESP_HTTP_CLIENT
monitor_rts = 0
monitor_dtr = 0

; ═══════════════════════════════════════════════════════════════════════════
; OTA Environment (for wireless firmware updates)
; ═══════════════════════════════════════════════════════════════════════════

[env:esp32s3-ota]
board = esp32-s3-devkitc-1
board_build.arduino.memory_type = qio_opi
board_build.partitions = min_spiffs.csv
upload_protocol = espota
upload_port = 10.10.0.123  ; Replace with your device IP
upload_flags =
    --auth=obedio
    --port=3232

; ═══════════════════════════════════════════════════════════════════════════
; Custom Partition Table (8MB Flash)
; ═══════════════════════════════════════════════════════════════════════════
;
; Create a file named "default_8MB.csv" in the project root with:
;
; # Name,   Type, SubType, Offset,  Size, Flags
; nvs,      data, nvs,     0x9000,  0x5000,
; otadata,  data, ota,     0xe000,  0x2000,
; app0,     app,  ota_0,   0x10000, 0x300000,
; app1,     app,  ota_1,   0x310000,0x300000,
; spiffs,   data, spiffs,  0x610000,0x180000,
; ═══════════════════════════════════════════════════════════════════════════
